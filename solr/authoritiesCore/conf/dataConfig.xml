<dataConfig>
<dataSource type="JdbcDataSource"
            driver="com.mysql.jdbc.Driver"
            url="jdbc:mysql://da-il.library.cornell.edu:3306/headings"
            user="dna_read"
            password="xyzzy"/>
<document>
<entity name="author"
  transformer="RegexTransformer"
        query=" 
           select h.id,
           h.heading,
           h.sort as headingSort,
           h.works_by as worksBy,
           h.works_about as worksAbout,
           h.type_desc
      from heading as h
      
    left join (reference as r2, heading as h2, ref_type as rt2)
        on (r2.from_heading = h.id
            and h2.id = r2.to_heading
            and r2.ref_type = rt2.id
            and rt2.name = &quot;seeAlso&quot; )
    
    left join (reference as r3, heading as h3, ref_type as rt3)
        on (r3.from_heading = h.id
            and h3.id = r3.to_heading
            and r3.ref_type = rt3.id
            and rt3.name = &quot;preferedForm&quot; )
    
     where h.works_by > 0
        or h2.works_by > 0
        or h3.works_by > 0
     group by h.id">
   
   <entity name="altForms"
     query="select form as alternateForm
              from alt_form
       where heading_id = ${author.id}
       order by 1" />
     
   <entity name="notes"
     query="select note as notes
              from note
       where heading_id = ${author.id}" />
       
          
   <entity name="typeDesc"
     query="select name as headingTypeDesc
              from type_desc
       where id = ${author.type_desc}" />
       
   <entity name="seeAlso"
	 query="select concat( h2.heading, &quot;|&quot;, r2.ref_desc,&quot;|&quot;, 
	                       h2.works_about, &quot;|&quot;, h2.works_by) as seeAlso
              from heading as h2, reference as r2, ref_type as rt2
             where r2.from_heading = ${author.id}
               and h2.id = r2.to_heading
               and r2.ref_type = rt2.id
               and rt2.name = &quot;seeAlso&quot;" />

   <entity name="preferedForm"
	 query="select concat( h2.heading, &quot;|&quot;, r2.ref_desc,&quot;|&quot;, 
	                       h2.works_about, &quot;|&quot;, h2.works_by) as preferedForm
              from heading as h2, reference as r2, ref_type as rt2
             where r2.from_heading = ${author.id}
               and h2.id = r2.to_heading
               and r2.ref_type = rt2.id
               and rt2.name = &quot;preferedForm&quot;" />

</entity>
</document>
</dataConfig>