# This gets the holdings record for a bib record.
# This assumes that the id is in the rdfs:label

#( this is a UTF-8 file )
prefix marc: <http://marcrdf.library.cornell.edu/canonical/0.1/>

CONSTRUCT  {
  ?hrec marc:leader ?l .
  ?hrec marc:hasField ?f .
  ?f marc:tag ?t.
  ?f marc:value ?v.
  
  ?f marc:hasSubfield ?sf .
  ?sf ?sfp ?sfo .
  
  ?f ?fp ?fo.
}
WHERE {

  {
    ?hrec marc:leader ?l .
  }UNION {
    ?hrec marc:hasField ?f .
    OPTIONAL{?f marc:tag ?t.}
    OPTIONAL{?f marc:value ?v.}
    OPTIONAL{ 
      ?f marc:hasSubfield ?sf .
      ?sf ?sfp ?sfo .
    }
  }

  
#subquery to get the holdings records for the bib record  
{
  SELECT ?hrec WHERE{
   ?hrec marc:hasField ?f .
   ?f    marc:value ?brecId .
   ?f    marc:tag "004" .

   {
     SELECT STR(?v) as ?brecId WHERE {
       <http://da-rdf.library.cornell.edu/individual/b2> marc:hasField ?f .
       ?f marc:tag "001" .
       ?f marc:value ?v
     }
   }
  }
}

}

